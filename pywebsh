#!/usr/bin/env python

import argparse
import json
import requests
import sys

POST_URL = "https://websh.jiro4989.com/api/shellgei"


def post(code):
    data = json.dumps({"code": code, "images": []})
    response = requests.post(url=POST_URL, data=data)
    response.raise_for_status()
    result = json.loads(response.text)
    return result


def print_result(result, property):
    if property is None:
        return

    print("[ \033[36;1m{0}\033[m ] {1}".format(property, result[property]))


if __name__ == "__main__":
    p = argparse.ArgumentParser()
    p.add_argument("code", type=str, help="code to execute on shellgeibot")
    p.add_argument("-v", "--verbose", action="store_true")
    args = p.parse_args()
    result = post(code=args.code)
    if args.verbose:
        for p in ["status", "elapsed_time", "system_message"]:
            print_result(result, p)

        print(result["stdout"], file=sys.stdout)
        print(result["stderr"], file=sys.stderr)
    else:
        print(result["stdout"], file=sys.stdout)
        print(result["stderr"], file=sys.stderr)
